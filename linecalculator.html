<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line Length Calculator | Ernesto Pe√±a</title>
    <meta name="description" content="Calculate optimal line length based on typeface metrics and character density. Based on Pe√±a (2016): Calculating Line Length: an arithmetic approach.">
    <meta name="author" content="Ernesto Pe√±a">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5F05KEVBC8"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-5F05KEVBC8');
    </script>

    <style>
/* === BASE RESET === */
* { margin: 0; padding: 0; box-sizing: border-box; }

/* === CSS VARIABLES === */
:root {
  --font: 'Roboto Mono', monospace;
  --bg: #0a0a0a;
  --text: #e0e0e0;
  --accent: #FF00FF;
  --accent-secondary: #00bcd4;
  --accent-tertiary: #8bc34a;
  --muted: #666;
  --border: #222;
  --panel-bg: #111;
  --hover-bg: #1a1a1a;
  --hover-text: #fff;
  --input-bg: #1a1a1a;
}

[data-theme="light"] {
  --bg: #ffffff;
  --text: #000000;
  --accent: #FF00FF;
  --accent-secondary: #00bcd4;
  --accent-tertiary: #8bc34a;
  --muted: #666666;
  --border: #e0e0e0;
  --panel-bg: #f5f5f5;
  --hover-bg: #e8e8e8;
  --hover-text: #000;
  --input-bg: #f8f8f8;
}

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  padding: clamp(1rem, 1rem + ((1vw - 0.48rem) * 0.288), 1.125rem);
  font-size: clamp(0.875rem, 0.875rem + ((1vw - 0.48rem) * 0.288), 1rem);
  line-height: 1.6;
  transition: background-color 0.3s, color 0.3s;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
}

/* === HEADER === */
header {
  margin-bottom: clamp(1rem, 1rem + ((1vw - 0.48rem) * 0.288), 1.125rem);
  padding-bottom: 12px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  flex-wrap: wrap;
  gap: 12px;
}

.header-content {
  flex: 1;
  min-width: 200px;
}

h1 {
  color: var(--accent);
  font-size: clamp(1.75rem, 1.75rem + ((1vw - 0.48rem) * 0.288), 1.875rem);
  margin-bottom: 4px;
  font-weight: 400;
  line-height: 1.2;
}

.subtitle {
  color: var(--muted);
  font-size: clamp(0.8125rem, 0.8125rem + ((1vw - 0.48rem) * 0.144), 0.875rem);
  line-height: 1.5;
}

.theme-toggle {
  padding: 6px 12px;
  background: var(--panel-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--text);
  cursor: pointer;
  font-family: inherit;
  font-size: clamp(0.625rem, 0.625rem + ((1vw - 0.48rem) * 0.072), 0.6563rem);
  transition: all 0.15s;
  display: flex;
  align-items: center;
  gap: 6px;
}

.theme-toggle:hover {
  border-color: var(--accent);
  background: var(--hover-bg);
}

.theme-toggle:focus {
  outline: 2px dashed var(--accent);
  outline-offset: 2px;
}

/* === MAIN CONTENT === */
.main-content {
  padding-top: clamp(1rem, 1rem + ((1vw - 0.48rem) * 0.577), 1.25rem);
  padding-bottom: clamp(1rem, 1rem + ((1vw - 0.48rem) * 0.577), 1.25rem);
}

/* === INFO PANEL === */
.info-panel {
  margin-bottom: clamp(1.25rem, 1.25rem + ((1vw - 0.48rem) * 0.577), 1.5rem);
  background: var(--panel-bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  transition: background-color 0.3s, border-color 0.3s;
}

.info-toggle {
  width: 100%;
  padding: clamp(0.875rem, 0.875rem + ((1vw - 0.48rem) * 0.288), 1rem);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: transparent;
  border: none;
  color: var(--text);
  cursor: pointer;
  font-family: inherit;
  font-weight: 700;
  font-size: clamp(0.8125rem, 0.8125rem + ((1vw - 0.48rem) * 0.144), 0.875rem);
  transition: background-color 0.15s;
}

.info-toggle:hover {
  background: var(--hover-bg);
}

.info-toggle:focus {
  outline: 2px dashed var(--accent);
  outline-offset: -2px;
}

.info-content {
  padding: 0 clamp(0.875rem, 0.875rem + ((1vw - 0.48rem) * 0.288), 1rem) clamp(0.875rem, 0.875rem + ((1vw - 0.48rem) * 0.288), 1rem);
  border-top: 1px solid var(--border);
  color: var(--text);
  font-size: clamp(0.6875rem, 0.6875rem + ((1vw - 0.48rem) * 0.072), 0.7188rem);
  display: none;
}

.info-content.visible {
  display: block;
}

.info-content p {
  margin: 0.5rem 0;
}

/* === GRID LAYOUT === */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: clamp(1rem, 1rem + ((1vw - 0.48rem) * 0.577), 1.25rem);
}

/* === CARDS === */
.card {
  background: var(--panel-bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: clamp(1rem, 1rem + ((1vw - 0.48rem) * 0.577), 1.25rem);
  transition: background-color 0.3s, border-color 0.3s;
}

.card h2 {
  font-size: clamp(1.125rem, 1.125rem + ((1vw - 0.48rem) * 0.577), 1.375rem);
  font-weight: 700;
  margin-bottom: clamp(0.75rem, 0.75rem + ((1vw - 0.48rem) * 0.288), 0.875rem);
  color: var(--accent);
}

/* === FORM ELEMENTS === */
.label {
  display: block;
  font-size: clamp(0.6875rem, 0.6875rem + ((1vw - 0.48rem) * 0.072), 0.7188rem);
  font-weight: 700;
  margin-bottom: 8px;
  color: var(--text);
}

.upload-button {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  background: var(--accent);
  color: var(--bg);
  font-weight: 700;
  padding: 10px 16px;
  border-radius: 4px;
  cursor: pointer;
  border: none;
  width: 100%;
  font-family: inherit;
  font-size: clamp(0.6875rem, 0.6875rem + ((1vw - 0.48rem) * 0.072), 0.7188rem);
  transition: all 0.15s;
}

.upload-button:hover {
  background: #cc00cc;
  transform: translateY(-1px);
}

.upload-button:active {
  transform: translateY(0);
}

.upload-button:focus {
  outline: 2px dashed var(--accent);
  outline-offset: 2px;
}

.font-info {
  margin-top: 8px;
  font-size: clamp(0.6875rem, 0.6875rem + ((1vw - 0.48rem) * 0.072), 0.7188rem);
  color: var(--accent);
}

.helper-text {
  font-size: clamp(0.625rem, 0.625rem + ((1vw - 0.48rem) * 0.072), 0.6563rem);
  margin-top: 6px;
  color: var(--muted);
  line-height: 1.4;
}

.input-group {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 8px;
}

.input-range {
  flex: 1;
  accent-color: var(--accent);
  cursor: pointer;
}

.input-number {
  width: 5rem;
  background: var(--input-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 8px 10px;
  color: var(--text);
  font-family: inherit;
  font-size: clamp(0.6875rem, 0.6875rem + ((1vw - 0.48rem) * 0.072), 0.7188rem);
  transition: all 0.15s;
}

.input-number:hover {
  border-color: var(--accent);
}

.input-number:focus {
  outline: 2px dashed var(--accent);
  outline-offset: 2px;
  border-color: var(--accent);
}

/* === METRICS === */
.metric-label {
  display: block;
  font-size: clamp(0.6875rem, 0.6875rem + ((1vw - 0.48rem) * 0.072), 0.7188rem);
  margin-bottom: 6px;
  color: var(--text);
}

.metric-value {
  font-size: clamp(1.25rem, 1.25rem + ((1vw - 0.48rem) * 0.577), 1.5rem);
  font-weight: 700;
  color: var(--accent);
}

.constant-value {
  font-size: clamp(1.125rem, 1.125rem + ((1vw - 0.48rem) * 0.288), 1.25rem);
  font-weight: 700;
  color: var(--text);
}

/* === RESULTS === */
.result-card {
  background: var(--panel-bg);
  border: 2px solid var(--accent);
  border-radius: 6px;
  padding: clamp(1rem, 1rem + ((1vw - 0.48rem) * 0.577), 1.25rem);
  transition: background-color 0.3s, border-color 0.3s;
}

.result-card h2 {
  color: var(--accent);
}

.result-main {
  font-size: clamp(1.75rem, 1.75rem + ((1vw - 0.48rem) * 1.154), 2.25rem);
  font-weight: 700;
  color: var(--accent);
}

.result-secondary {
  font-size: clamp(1.25rem, 1.25rem + ((1vw - 0.48rem) * 0.577), 1.5rem);
  font-weight: 700;
  color: var(--accent);
}

.result-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  padding-top: 0.5rem;
}

.result-small {
  font-size: clamp(0.9375rem, 0.9375rem + ((1vw - 0.48rem) * 0.288), 1.0625rem);
  font-weight: 700;
  color: var(--accent);
}

/* === BENCHMARKS === */
.benchmark-item {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 10px;
  margin-bottom: 8px;
  transition: background-color 0.3s, border-color 0.3s;
}

.benchmark-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
}

.apply-button {
  font-size: clamp(0.625rem, 0.625rem + ((1vw - 0.48rem) * 0.072), 0.6563rem);
  background: var(--accent);
  color: var(--bg);
  padding: 4px 8px;
  border-radius: 3px;
  border: none;
  font-weight: 700;
  cursor: pointer;
  font-family: inherit;
  transition: all 0.15s;
}

.apply-button:hover {
  background: #cc00cc;
}

.apply-button:focus {
  outline: 2px dashed var(--accent);
  outline-offset: 2px;
}

/* === FORMULA DISPLAY === */
.formula-display {
  margin-top: clamp(1rem, 1rem + ((1vw - 0.48rem) * 0.577), 1.25rem);
  background: var(--panel-bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: clamp(1rem, 1rem + ((1vw - 0.48rem) * 0.577), 1.25rem);
  display: none;
  transition: background-color 0.3s, border-color 0.3s;
}

.formula-display.visible {
  display: block;
}

.formula-display h3 {
  font-size: clamp(0.9375rem, 0.9375rem + ((1vw - 0.48rem) * 0.288), 1.0625rem);
  font-weight: 700;
  margin-bottom: 12px;
  color: var(--accent);
}

.formula {
  font-size: clamp(0.9375rem, 0.9375rem + ((1vw - 0.48rem) * 0.288), 1.0625rem);
  background: var(--bg);
  padding: 12px;
  border-radius: 4px;
  overflow-x: auto;
  transition: background-color 0.3s;
}

/* === FOOTER === */
footer {
  margin-top: clamp(1.5rem, 1.5rem + ((1vw - 0.48rem) * 1.442), 2rem);
  padding-top: 14px;
  border-top: 1px solid var(--border);
  font-size: clamp(0.625rem, 0.625rem + ((1vw - 0.48rem) * 0.072), 0.6563rem);
  color: var(--muted);
  text-align: center;
  line-height: 1.6;
}

footer a {
  color: var(--accent);
  text-decoration: underline;
  transition: all 0.15s;
}

footer a:hover {
  text-decoration: none;
  color: var(--hover-text);
}

footer a:focus {
  text-decoration: underline dashed;
  outline: 2px dashed var(--accent);
  outline-offset: 2px;
}

.zotero-button {
  font-size: clamp(0.6875rem, 0.6875rem + ((1vw - 0.48rem) * 0.072), 0.7188rem);
  color: var(--accent);
  background: none;
  border: none;
  cursor: pointer;
  font-family: inherit;
  margin-top: 8px;
  transition: color 0.15s;
}

.zotero-button:hover {
  color: var(--hover-text);
}

.zotero-button:focus {
  outline: 2px dashed var(--accent);
  outline-offset: 2px;
}

/* === UTILITY === */
.empty-state {
  text-align: center;
  padding: clamp(1.5rem, 1.5rem + ((1vw - 0.48rem) * 0.577), 1.875rem) 0;
  color: var(--muted);
}

.hidden {
  display: none;
}
    </style>
</head>
<body>
    <canvas id="measureCanvas" style="display: none;"></canvas>
    
    <div class="container">
        <header>
            <div class="header-content">
                <h1>Line Length Calculator</h1>
                <p class="subtitle">Based on Pe√±a (2016): LCA' √ó CœÅ(S) = Ll</p>
            </div>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                <span id="themeIcon">‚òÄÔ∏è</span>
                <span id="themeText">Light</span>
            </button>
        </header>

        <div class="main-content">
            <div class="info-panel">
                <button class="info-toggle" id="infoToggle">
                    <span><strong style="color: var(--accent);">‚Ñπ</strong> About this Calculator</span>
                    <span style="color: var(--accent);">+</span>
                </button>
                <div class="info-content" id="infoContent">
                    <div style="margin-top: 1rem;">
                        <p><strong style="color: var(--accent);">LCA'</strong> = Length of lowercase alphabet (abcdefghijklmnopqrstuvwxyz + space) in points</p>
                        <p><strong style="color: var(--accent);">CœÅ</strong> = Desired character density (characters per line, including spaces)</p>
                        <p><strong style="color: var(--accent);">S</strong> = Mathematical constant (0.0345 = 1/29 for Roman alphabet serif fonts)</p>
                        <p><strong style="color: var(--accent);">Ll</strong> = Resulting line length in points</p>
                        <p style="padding-top: 0.5rem; color: var(--muted);">
                            Upload a font file (.ttf, .otf, or .woff) and set your desired font size. 
                            The calculator will measure the lowercase alphabet with space and compute optimal line lengths 
                            for various character densities. Accuracy: ~5% for common serif typefaces.
                        </p>
                    </div>
                </div>
            </div>

            <div class="grid">
                <!-- Left Column -->
                <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                    <!-- Font Upload -->
                    <div class="card">
                        <h2>1. Load Font</h2>
                        <label class="label">Upload Font File</label>
                        <input type="file" id="fontUpload" accept=".ttf,.otf,.woff,.woff2" class="hidden">
                        <label for="fontUpload" class="upload-button">
                            ‚Üë Choose Font File
                        </label>
                        <div id="fontInfo" class="font-info hidden"></div>
                        <p class="helper-text">Supported formats: .ttf, .otf, .woff, .woff2</p>
                        
                        <div style="margin-top: 1rem;">
                            <label class="label">Font Size</label>
                            <div class="input-group">
                                <input type="range" id="fontSizeRange" min="6" max="24" value="10" step="0.5" class="input-range" disabled>
                                <input type="number" id="fontSizeNumber" value="10" step="0.5" class="input-number" disabled>
                                <span style="color: var(--text);">pt</span>
                            </div>
                        </div>
                    </div>

                    <!-- Calculated Metrics -->
                    <div class="card">
                        <h2>Calculated Metrics</h2>
                        <div style="margin-bottom: 1rem;">
                            <label class="metric-label">LCA' (Lowercase Alphabet + Space)</label>
                            <div class="metric-value" id="lcaValue">‚Äî</div>
                            <div id="lcaDisplay" class="helper-text hidden"></div>
                        </div>
                        <div>
                            <label class="metric-label">S Constant</label>
                            <div class="constant-value">0.0345</div>
                        </div>
                    </div>

                    <!-- Character Density -->
                    <div class="card">
                        <h2>2. Set Character Density</h2>
                        <label class="label">CœÅ (Characters Per Line)</label>
                        <div class="input-group">
                            <input type="range" id="densityRange" min="20" max="100" value="65" class="input-range">
                            <input type="number" id="densityNumber" value="65" class="input-number">
                            <span style="color: var(--text);">CPL</span>
                        </div>
                        <p class="helper-text">Including spaces</p>
                    </div>

                    <!-- Formula Display -->
                    <div class="formula-display" id="formulaDisplay">
                        <h3>Current Calculation</h3>
                        <div class="formula" id="formulaContent"></div>
                    </div>
                </div>

                <!-- Right Column -->
                <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                    <!-- Results -->
                    <div class="result-card">
                        <h2>Calculated Line Length</h2>
                        <div id="resultsContent">
                            <div class="empty-state">Upload a font to see results</div>
                        </div>
                    </div>

                    <!-- Readability Benchmarks -->
                    <div class="card">
                        <h2>Readability Benchmarks</h2>
                        <div id="benchmarks"></div>
                    </div>

                    <!-- Research-Based Ranges -->
                    <div class="card">
                        <h2>Research-Based Ranges</h2>
                        <div style="font-size: clamp(0.6875rem, 0.6875rem + ((1vw - 0.48rem) * 0.072), 0.7188rem);">
                            <div style="margin-bottom: 0.75rem;">
                                <div style="font-weight: 700; margin-bottom: 0.25rem;">Novice Readers (De Buen, 2014)</div>
                                <div style="color: var(--text);">Range: 34-60 CPL | Optimal: 45 CPL</div>
                            </div>
                            <div style="margin-bottom: 0.75rem;">
                                <div style="font-weight: 700; margin-bottom: 0.25rem;">Expert Readers (De Buen, 2014)</div>
                                <div style="color: var(--text);">Range: 45-80 CPL | Optimal: 60 CPL</div>
                            </div>
                            <div>
                                <div style="font-weight: 700; margin-bottom: 0.25rem;">Bringhurst Standard</div>
                                <div style="color: var(--text);">Range: 45-75 CPL | Ideal: 66 CPL</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>
                <a href="https://doi.org/10.34314/vl.v50i1.3986" target="_blank" rel="noopener noreferrer">
                    Pe√±a, E. (2016). Calculating Line Length: an arithmetic approach. Visible Language, 50(1), 112-125.
                </a>
            </p>
            <button class="zotero-button" id="zoteroButton">üìö Save to Zotero</button>
            <p style="margin-top: 12px;">
                Line Length Calculator ‚Äî A Type Design Tool<br>
                Created by Ernesto Pe√±a | <a href="https://ernestopena.com" target="_blank">ernestopena.com</a>
            </p>
        </footer>
    </div>

    <script>
// === THEME TOGGLE ===
const themeToggle = document.getElementById('themeToggle');
const themeIcon = document.getElementById('themeIcon');
const themeText = document.getElementById('themeText');
const html = document.documentElement;

const getPreferredTheme = () => {
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme) return savedTheme;
  return window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
};

const setTheme = (theme) => {
  if (theme === 'light') {
    html.setAttribute('data-theme', 'light');
    themeIcon.textContent = 'üåô';
    themeText.textContent = 'Dark';
  } else {
    html.removeAttribute('data-theme');
    themeIcon.textContent = '‚òÄÔ∏è';
    themeText.textContent = 'Light';
  }
  localStorage.setItem('theme', theme);
};

setTheme(getPreferredTheme());

themeToggle.addEventListener('click', () => {
  const currentTheme = html.getAttribute('data-theme');
  const newTheme = currentTheme === 'light' ? 'dark' : 'light';
  setTheme(newTheme);
});

window.matchMedia('(prefers-color-scheme: light)').addEventListener('change', (e) => {
  if (!localStorage.getItem('theme')) {
    setTheme(e.matches ? 'light' : 'dark');
  }
});

// === LINE LENGTH CALCULATOR ===
const S_CONSTANT = 0.0345;
const LCA_STRING = 'abcdefghijklmnopqrstuvwxyz ';

let fontFile = null;
let fontName = '';
let fontSize = 10;
let lcaPrime = null;
let charDensity = 65;

const canvas = document.getElementById('measureCanvas');
const ctx = canvas.getContext('2d');

const recommendations = [
    { label: "Minimum (Novice)", value: 34 },
    { label: "Optimal (Novice)", value: 45 },
    { label: "Optimal (Expert)", value: 60 },
    { label: "Bringhurst Ideal", value: 66 },
    { label: "Maximum (Expert)", value: 80 }
];

// Info toggle
document.getElementById('infoToggle').addEventListener('click', () => {
    const content = document.getElementById('infoContent');
    const toggle = document.getElementById('infoToggle').querySelector('span:last-child');
    content.classList.toggle('visible');
    toggle.textContent = content.classList.contains('visible') ? '‚àí' : '+';
});

// Font upload
document.getElementById('fontUpload').addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
        try {
            const fontBuffer = event.target.result;
            const font = new FontFace('UploadedFont', fontBuffer);
            
            font.load().then((loadedFont) => {
                document.fonts.add(loadedFont);
                fontFile = loadedFont;
                fontName = file.name.replace(/\.[^/.]+$/, '');
                
                document.getElementById('fontInfo').textContent = `Loaded: ${fontName}`;
                document.getElementById('fontInfo').classList.remove('hidden');
                
                document.getElementById('fontSizeRange').disabled = false;
                document.getElementById('fontSizeNumber').disabled = false;
                
                calculateLCA();
            }).catch(err => {
                console.error('Font loading error:', err);
                alert('Error loading font. Please try a different font file.');
            });
        } catch (err) {
            console.error('Font parsing error:', err);
            alert('Error parsing font file. Please ensure it\'s a valid .ttf, .otf, or .woff file.');
        }
    };
    reader.readAsArrayBuffer(file);
});

// Font size controls
document.getElementById('fontSizeRange').addEventListener('input', (e) => {
    fontSize = parseFloat(e.target.value);
    document.getElementById('fontSizeNumber').value = fontSize;
    if (fontFile) calculateLCA();
});

document.getElementById('fontSizeNumber').addEventListener('input', (e) => {
    fontSize = parseFloat(e.target.value) || 10;
    document.getElementById('fontSizeRange').value = fontSize;
    if (fontFile) calculateLCA();
});

// Density controls
document.getElementById('densityRange').addEventListener('input', (e) => {
    charDensity = parseInt(e.target.value);
    document.getElementById('densityNumber').value = charDensity;
    updateResults();
    updateBenchmarks();
});

document.getElementById('densityNumber').addEventListener('input', (e) => {
    charDensity = parseInt(e.target.value) || 65;
    document.getElementById('densityRange').value = charDensity;
    updateResults();
    updateBenchmarks();
});

function calculateLCA() {
    ctx.font = `${fontSize}pt UploadedFont`;
    lcaPrime = ctx.measureText(LCA_STRING).width;
    
    document.getElementById('lcaValue').textContent = `${lcaPrime.toFixed(2)} pt`;
    document.getElementById('lcaDisplay').textContent = LCA_STRING;
    document.getElementById('lcaDisplay').style.fontFamily = 'UploadedFont';
    document.getElementById('lcaDisplay').classList.remove('hidden');
    
    updateResults();
    updateBenchmarks();
}

function updateResults() {
    if (!lcaPrime) return;
    
    const lineLength = lcaPrime * charDensity * S_CONSTANT;
    const picas = Math.floor(lineLength / 12);
    const picasRemainder = (lineLength % 12).toFixed(2);
    const mm = (lineLength * 0.3527777778).toFixed(2);
    const inches = (lineLength / 72).toFixed(2);
    
    const html = `
        <div style="display: flex; flex-direction: column; gap: 0.75rem;">
            <div>
                <div style="font-size: clamp(0.6875rem, 0.6875rem + ((1vw - 0.48rem) * 0.072), 0.7188rem); margin-bottom: 0.25rem; color: var(--text);">Points</div>
                <div class="result-main">${lineLength.toFixed(2)} pt</div>
            </div>
            <div>
                <div style="font-size: clamp(0.6875rem, 0.6875rem + ((1vw - 0.48rem) * 0.072), 0.7188rem); margin-bottom: 0.25rem; color: var(--text);">Picas</div>
                <div class="result-secondary">${picas}p${picasRemainder}</div>
            </div>
            <div class="result-grid">
                <div>
                    <div style="font-size: clamp(0.625rem, 0.625rem + ((1vw - 0.48rem) * 0.072), 0.6563rem); margin-bottom: 0.25rem; color: var(--text);">Millimeters</div>
                    <div class="result-small">${mm} mm</div>
                </div>
                <div>
                    <div style="font-size: clamp(0.625rem, 0.625rem + ((1vw - 0.48rem) * 0.072), 0.6563rem); margin-bottom: 0.25rem; color: var(--text);">Inches</div>
                    <div class="result-small">${inches} in</div>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('resultsContent').innerHTML = html;
    
    // Show formula
    const formulaHtml = `
        <span style="color: var(--accent-secondary);">${lcaPrime.toFixed(2)}</span>
        <span style="color: var(--muted);"> √ó </span>
        <span style="color: var(--accent-tertiary);">${charDensity}</span>
        <span style="color: var(--muted);">(</span>
        <span style="color: #ff9800;">${S_CONSTANT}</span>
        <span style="color: var(--muted);">)</span>
        <span style="color: var(--muted);"> = </span>
        <span style="color: var(--accent);">${lineLength.toFixed(2)}</span>
        <span style="color: var(--muted);"> pt</span>
    `;
    
    document.getElementById('formulaContent').innerHTML = formulaHtml;
    document.getElementById('formulaDisplay').classList.add('visible');
}

function calculateForDensity(density) {
    if (!lcaPrime) return { points: '‚Äî', picas: '‚Äî' };
    const ll = lcaPrime * density * S_CONSTANT;
    return {
        points: ll.toFixed(2),
        picas: `${Math.floor(ll / 12)}p${(ll % 12).toFixed(2)}`
    };
}

function updateBenchmarks() {
    const html = recommendations.map(rec => {
        const result = calculateForDensity(rec.value);
        return `
            <div class="benchmark-item">
                <div class="benchmark-header">
                    <span style="font-weight: 700; font-size: clamp(0.6875rem, 0.6875rem + ((1vw - 0.48rem) * 0.072), 0.7188rem);">${rec.label}</span>
                    <button class="apply-button" onclick="applyDensity(${rec.value})">Apply</button>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: clamp(0.6875rem, 0.6875rem + ((1vw - 0.48rem) * 0.072), 0.7188rem);">
                    <span style="color: var(--text);">${rec.value} CPL</span>
                    <span style="color: var(--accent);">${result.picas}</span>
                </div>
            </div>
        `;
    }).join('');
    
    document.getElementById('benchmarks').innerHTML = html;
}

function applyDensity(value) {
    charDensity = value;
    document.getElementById('densityRange').value = value;
    document.getElementById('densityNumber').value = value;
    updateResults();
    updateBenchmarks();
}

// Zotero button
document.getElementById('zoteroButton').addEventListener('click', () => {
    const title = 'Calculating Line Length: an arithmetic approach';
    const creators = 'Ernesto Pe√±a';
    const url = 'https://doi.org/10.34314/vl.v50i1.3986';
    window.open(`https://www.zotero.org/save?title=${encodeURIComponent(title)}&creators=${encodeURIComponent(creators)}&url=${encodeURIComponent(url)}`, '_blank');
});

// Initial benchmarks
updateBenchmarks();
    </script>
</body>
</html>
