<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pixel Sorter</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-8XQLL5N022"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-8XQLL5N022');
  </script>
  <meta name="citation_title" content="Pixel Sorter">
  <meta name="citation_author" content="PeÃ±a, Ernesto">
  <meta name="citation_publication_date" content="2026/01/08">
  <meta name="citation_technical_report_institution" content="Northeastern University">
  <meta name="citation_technical_report_number" content="v1.0">
  <meta name="citation_abstract" content="A browser-based pixel sorting tool for glitch art. Rearrange pixels by brightness, hue, saturation, or individual colour channels with adjustable spatial and brightness thresholds.">
  <meta name="citation_keywords" content="pixel sorting; glitch art; image processing; databending">
  <meta name="citation_public_url" content="https://epsidebox.github.io/sidebox.github.io/pixel-sorter-html.html">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "Pixel Sorter",
    "author": {
      "@type": "Person",
      "name": "Ernesto PeÃ±a",
      "affiliation": "Northeastern University",
      "url": "https://ernestopena.com"
    },
    "datePublished": "2026-01-08",
    "version": "1.0",
    "description": "A browser-based pixel sorting tool for glitch art. Rearrange pixels by brightness, hue, saturation, or individual colour channels with adjustable spatial and brightness thresholds.",
    "url": "https://epsidebox.github.io/sidebox.github.io/pixel-sorter-html.html",
    "applicationCategory": "EducationalApplication",
    "operatingSystem": "Web browser",
    "keywords": ["pixel sorting", "glitch art", "image processing", "databending"]
  }
  </script>
  <style>
/* === BASE RESET === */
* { margin: 0; padding: 0; box-sizing: border-box; }

/* === CSS VARIABLES === */
:root {
  --font: 'Roboto Mono', monospace;
  --bg: #0a0a0a;
  --text: #e0e0e0;
  --accent: #FF00FF;
  --muted: #666;
  --border: #222;
  --panel-bg: #111;
  --hover-bg: #1a1a1a;
  --hover-text: #fff;
  --input-bg: #1a1a1a;
  --canvas-bg: #000;
}

[data-theme="light"] {
  --bg: #ffffff;
  --text: #000000;
  --accent: #FF00FF;
  --muted: #666666;
  --border: #e0e0e0;
  --panel-bg: #f5f5f5;
  --hover-bg: #e8e8e8;
  --hover-text: #000;
  --input-bg: #f8f8f8;
  --canvas-bg: #fafafa;
}

/* === TYPOGRAPHY === */
body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  margin: 0;
  display: flex;
  min-height: 100vh;
  font-size: clamp(0.75rem, 0.75rem + ((1vw - 0.48rem) * 0.072), 0.7813rem);
  line-height: 1.6;
  transition: background-color 0.3s, color 0.3s;
}

/* === SIDEBAR CONTROLS === */
#controls {
  width: 240px;
  padding: 20px;
  background: var(--panel-bg);
  color: var(--text);
  border-right: 1px solid var(--border);
  overflow-y: auto;
  min-height: 100vh;
  position: fixed;
  top: 0;
  left: 0;
  transition: background-color 0.3s, border-color 0.3s;
  display: flex;
  flex-direction: column;
}

.sidebar-header {
  margin-bottom: 16px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border);
}

.sidebar-header h1 {
  color: var(--accent);
  font-size: clamp(1.75rem, 1.75rem + ((1vw - 0.48rem) * 0.288), 1.875rem);
  font-weight: 400;
  margin-bottom: 6px;
  line-height: 1.2;
}

.sidebar-header .subtitle {
  font-size: clamp(0.6875rem, 0.6875rem + ((1vw - 0.48rem) * 0.072), 0.7188rem);
  color: var(--muted);
  line-height: 1.4;
}

/* === THEME TOGGLE === */
.theme-toggle {
  background: var(--input-bg);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 8px 12px;
  font-family: var(--font);
  font-size: clamp(0.625rem, 0.625rem + ((1vw - 0.48rem) * 0.072), 0.6563rem);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  border-radius: 3px;
  transition: all 0.15s;
  margin-bottom: 16px;
}

.theme-toggle:hover {
  background: var(--hover-bg);
  border-color: var(--accent);
}

.theme-toggle:focus {
  outline: 2px dashed var(--accent);
  outline-offset: 2px;
}

.controls-section {
  flex: 1;
  overflow-y: auto;
}

#controls label {
  display: block;
  margin: 16px 0 6px;
  color: var(--text);
  font-weight: 500;
  font-size: clamp(0.6875rem, 0.6875rem + ((1vw - 0.48rem) * 0.072), 0.7188rem);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.value-display {
  color: var(--accent);
  font-size: clamp(0.625rem, 0.625rem + ((1vw - 0.48rem) * 0.072), 0.6563rem);
  font-weight: 700;
}

/* === RANGE INPUTS === */
#controls input[type="range"] {
  width: 100%;
  margin: 0;
  -webkit-appearance: none;
  background: var(--input-bg);
  height: 4px;
  border-radius: 2px;
  outline: none;
  transition: background 0.15s;
}

#controls input[type="range"]:hover {
  background: var(--hover-bg);
}

#controls input[type="range"]:focus {
  outline: 2px dashed var(--accent);
  outline-offset: 4px;
}

#controls input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  background: var(--accent);
  border-radius: 50%;
  cursor: pointer;
  transition: transform 0.15s, box-shadow 0.15s;
}

#controls input[type="range"]::-webkit-slider-thumb:hover {
  transform: scale(1.2);
  box-shadow: 0 0 8px var(--accent);
}

#controls input[type="range"]::-webkit-slider-thumb:active {
  transform: scale(0.95);
}

#controls input[type="range"]::-moz-range-thumb {
  width: 14px;
  height: 14px;
  background: var(--accent);
  border-radius: 50%;
  cursor: pointer;
  border: none;
  transition: transform 0.15s, box-shadow 0.15s;
}

#controls input[type="range"]::-moz-range-thumb:hover {
  transform: scale(1.2);
  box-shadow: 0 0 8px var(--accent);
}

#controls input[type="range"]::-moz-range-thumb:active {
  transform: scale(0.95);
}

/* === SELECT DROPDOWNS === */
#controls select {
  width: 100%;
  padding: 8px;
  background: var(--input-bg);
  color: var(--text);
  border: 1px solid var(--border);
  font-family: var(--font);
  font-size: clamp(0.6875rem, 0.6875rem + ((1vw - 0.48rem) * 0.072), 0.7188rem);
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.15s;
}

#controls select:hover {
  border-color: var(--accent);
  background: var(--hover-bg);
}

#controls select:focus {
  outline: 2px dashed var(--accent);
  outline-offset: 2px;
  border-color: var(--accent);
}

/* === FILE INPUT === */
#controls input[type="file"] {
  width: 100%;
  margin-bottom: 10px;
  font-family: var(--font);
  font-size: clamp(0.625rem, 0.625rem + ((1vw - 0.48rem) * 0.072), 0.6563rem);
  padding: 8px;
  background: var(--input-bg);
  border: 1px solid var(--border);
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.15s;
}

#controls input[type="file"]:hover {
  border-color: var(--accent);
}

#controls input[type="file"]:focus {
  outline: 2px dashed var(--accent);
  outline-offset: 2px;
}

/* === BUTTONS === */
.btn-row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 20px;
}

.btn-row button {
  flex: 1 1 45%;
  padding: 10px 8px;
  background: var(--input-bg);
  color: var(--text);
  border: 1px solid var(--border);
  cursor: pointer;
  font-family: var(--font);
  font-size: clamp(0.625rem, 0.625rem + ((1vw - 0.48rem) * 0.072), 0.6563rem);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  transition: all 0.15s;
  border-radius: 3px;
  font-weight: 500;
}

.btn-row button:hover {
  background: var(--hover-bg);
  border-color: var(--accent);
  transform: translateY(-1px);
}

.btn-row button:active {
  transform: translateY(0);
}

.btn-row button:focus {
  outline: 2px dashed var(--accent);
  outline-offset: 2px;
}

.btn-row button.primary {
  background: var(--accent);
  color: #fff;
  border-color: var(--accent);
  font-weight: 700;
}

.btn-row button.primary:hover {
  background: #cc00cc;
  border-color: #cc00cc;
  color: #fff;
}

/* === CANVAS CONTAINER === */
#canvas-container {
  margin-left: 240px;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  padding-bottom: 60px;
  background: var(--canvas-bg);
  flex: 1;
  transition: background-color 0.3s;
}

/* === FOOTER === */
footer {
  position: fixed;
  bottom: 0;
  left: 240px;
  right: 0;
  padding: 14px 20px;
  background: var(--panel-bg);
  border-top: 1px solid var(--border);
  text-align: center;
  font-size: clamp(0.625rem, 0.625rem + ((1vw - 0.48rem) * 0.072), 0.6563rem);
  color: var(--muted);
  line-height: 1.6;
  transition: background-color 0.3s, border-color 0.3s;
}

footer a {
  color: var(--accent);
  text-decoration: underline;
  transition: all 0.15s;
}

footer a:hover {
  text-decoration: none;
  color: var(--hover-text);
}

footer a:focus {
  text-decoration: underline dashed;
  outline: 2px dashed var(--accent);
  outline-offset: 2px;
}

/* === RESPONSIVE === */
@media (max-width: 768px) {
  #controls {
    position: relative;
    width: 100%;
    min-height: auto;
    border-right: none;
    border-bottom: 1px solid var(--border);
  }
  
  #canvas-container {
    margin-left: 0;
  }
  
  footer {
    left: 0;
  }
}
  </style>
</head>
<body>
  <div id="controls">
    <div class="sidebar-header">
      <h1>Pixel<br>Sorter</h1>
      <p class="subtitle">Brightness | Hue | Saturation | RGB</p>
    </div>
    
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
      <span id="themeIcon">ðŸŒ™</span>
      <span id="themeText">Dark</span>
    </button>
    
    <div class="controls-section">
      <input type="file" id="fileInput" accept="image/*">
      
      <label>Spatial Min: <span class="value-display" id="spMinVal">0%</span></label>
      <input type="range" id="spMin" min="0" max="100" value="0">
      
      <label>Spatial Max: <span class="value-display" id="spMaxVal">100%</span></label>
      <input type="range" id="spMax" min="0" max="100" value="100">
      
      <label>Brightness Min: <span class="value-display" id="brMinVal">25</span></label>
      <input type="range" id="brMin" min="0" max="255" value="25">
      
      <label>Brightness Max: <span class="value-display" id="brMaxVal">230</span></label>
      <input type="range" id="brMax" min="0" max="255" value="230">
      
      <label>Sort By</label>
      <select id="sortBy">
        <option value="brightness">Brightness</option>
        <option value="hue">Hue</option>
        <option value="saturation">Saturation</option>
        <option value="red">Red</option>
        <option value="green">Green</option>
        <option value="blue">Blue</option>
      </select>
      
      <label>Direction</label>
      <select id="direction">
        <option value="right">Right</option>
        <option value="left">Left</option>
        <option value="bottom">Bottom</option>
        <option value="top">Top</option>
      </select>
      
      <div class="btn-row">
        <button class="primary" id="sortBtn">Sort</button>
        <button id="resetBtn">Reset</button>
        <button id="saveBtn">Save</button>
      </div>
    </div>
  </div>
  
  <div id="canvas-container"></div>
  
  <footer>
    Pixel Sorter â€” A Glitch Pedagogy Tool<br>
    Created by Ernesto PeÃ±a | <a href="https://ernestopena.com" target="_blank">ernestopena.com</a>
  </footer>

<script>
// === THEME HANDLING ===
const themeToggle = document.getElementById('themeToggle');
const themeIcon = document.getElementById('themeIcon');
const themeText = document.getElementById('themeText');
const html = document.documentElement;

const getPreferredTheme = () => {
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme) return savedTheme;
  return 'dark';
};

const setTheme = (theme) => {
  html.setAttribute('data-theme', theme);
  localStorage.setItem('theme', theme);
  themeIcon.textContent = theme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
  themeText.textContent = theme === 'light' ? 'Dark' : 'Light';
};

setTheme(getPreferredTheme());

themeToggle.addEventListener('click', () => {
  const currentTheme = html.getAttribute('data-theme');
  const newTheme = currentTheme === 'light' ? 'dark' : 'light';
  setTheme(newTheme);
});

// === PIXEL SORTING LOGIC ===
let img, sortedImg;
let minSpatial=0, maxSpatial=100, minBright=25, maxBright=230;
let sortBy='brightness', sortDirection='right';

function setup() {
  let cnv = createCanvas(600, 400);
  cnv.parent('canvas-container');
  const currentTheme = html.getAttribute('data-theme');
  background(currentTheme === 'light' ? 250 : 10);
  fill(currentTheme === 'light' ? 100 : 150);
  noStroke();
  textAlign(CENTER, CENTER);
  textSize(14);
  textFont('Roboto Mono');
  text('Upload an image to begin', width/2, height/2);
}

document.getElementById('fileInput').addEventListener('change', function(e) {
  let file = e.target.files[0];
  if (file && file.type.startsWith('image/')) {
    let reader = new FileReader();
    reader.onload = function(ev) {
      loadImage(ev.target.result, im => {
        img = im;
        resizeCanvas(img.width, img.height);
        sortedImg = img.get();
        image(sortedImg, 0, 0);
      });
    };
    reader.readAsDataURL(file);
  }
});

document.getElementById('spMin').oninput = function() { 
  minSpatial = +this.value; 
  document.getElementById('spMinVal').textContent = this.value + '%'; 
};

document.getElementById('spMax').oninput = function() { 
  maxSpatial = +this.value; 
  document.getElementById('spMaxVal').textContent = this.value + '%'; 
};

document.getElementById('brMin').oninput = function() { 
  minBright = +this.value; 
  document.getElementById('brMinVal').textContent = this.value; 
};

document.getElementById('brMax').oninput = function() { 
  maxBright = +this.value; 
  document.getElementById('brMaxVal').textContent = this.value; 
};

document.getElementById('sortBy').onchange = function() { sortBy = this.value; };
document.getElementById('direction').onchange = function() { sortDirection = this.value; };
document.getElementById('sortBtn').onclick = sortPixels;
document.getElementById('resetBtn').onclick = () => { 
  if (img) { 
    sortedImg = img.get(); 
    image(sortedImg, 0, 0); 
  } 
};
document.getElementById('saveBtn').onclick = () => { 
  if (sortedImg) save(sortedImg, 'sorted.png'); 
};

function sortPixels() {
  if (!sortedImg) return;
  let horiz = (sortDirection === 'left' || sortDirection === 'right');
  let rev = (sortDirection === 'left' || sortDirection === 'top');
  sortedImg.loadPixels();
  
  if (horiz) {
    let minPx = Math.floor((minSpatial / 100) * sortedImg.width);
    let maxPx = Math.floor((maxSpatial / 100) * sortedImg.width);
    for (let y = 0; y < sortedImg.height; y++) {
      let row = [];
      for (let x = minPx; x < maxPx; x++) {
        let idx = (y * sortedImg.width + x) * 4;
        row.push({ r: sortedImg.pixels[idx], g: sortedImg.pixels[idx+1], b: sortedImg.pixels[idx+2], a: sortedImg.pixels[idx+3] });
      }
      let sorted = sortSpans(row, rev);
      for (let i = 0; i < sorted.length; i++) {
        let idx = (y * sortedImg.width + (minPx + i)) * 4;
        sortedImg.pixels[idx] = sorted[i].r;
        sortedImg.pixels[idx+1] = sorted[i].g;
        sortedImg.pixels[idx+2] = sorted[i].b;
        sortedImg.pixels[idx+3] = sorted[i].a;
      }
    }
  } else {
    let minPx = Math.floor((minSpatial / 100) * sortedImg.height);
    let maxPx = Math.floor((maxSpatial / 100) * sortedImg.height);
    for (let x = 0; x < sortedImg.width; x++) {
      let col = [];
      for (let y = minPx; y < maxPx; y++) {
        let idx = (y * sortedImg.width + x) * 4;
        col.push({ r: sortedImg.pixels[idx], g: sortedImg.pixels[idx+1], b: sortedImg.pixels[idx+2], a: sortedImg.pixels[idx+3] });
      }
      let sorted = sortSpans(col, rev);
      for (let i = 0; i < sorted.length; i++) {
        let idx = ((minPx + i) * sortedImg.width + x) * 4;
        sortedImg.pixels[idx] = sorted[i].r;
        sortedImg.pixels[idx+1] = sorted[i].g;
        sortedImg.pixels[idx+2] = sorted[i].b;
        sortedImg.pixels[idx+3] = sorted[i].a;
      }
    }
  }
  sortedImg.updatePixels();
  image(sortedImg, 0, 0);
}

function sortSpans(px, rev) {
  let res = [...px], i = 0;
  while (i < res.length) {
    while (i < res.length && !inThresh(res[i])) i++;
    let start = i;
    while (i < res.length && inThresh(res[i])) i++;
    if (i > start) {
      let span = res.slice(start, i);
      span.sort((a, b) => rev ? getVal(b) - getVal(a) : getVal(a) - getVal(b));
      for (let j = 0; j < span.length; j++) res[start + j] = span[j];
    }
  }
  return res;
}

function inThresh(p) { 
  let v = (p.r + p.g + p.b) / 3; 
  return v >= minBright && v <= maxBright; 
}

function getVal(p) {
  if (sortBy === 'brightness') return (p.r + p.g + p.b) / 3;
  if (sortBy === 'red') return p.r;
  if (sortBy === 'green') return p.g;
  if (sortBy === 'blue') return p.b;
  let r = p.r/255, g = p.g/255, b = p.b/255;
  let mx = Math.max(r,g,b), mn = Math.min(r,g,b);
  if (sortBy === 'saturation') return mx === 0 ? 0 : ((mx-mn)/mx)*255;
  let h = 0;
  if (mx !== mn) {
    let d = mx - mn;
    if (mx === r) h = ((g-b)/d + (g<b?6:0))/6;
    else if (mx === g) h = ((b-r)/d + 2)/6;
    else h = ((r-g)/d + 4)/6;
  }
  return h * 255;
}
</script>
</body>
</html>
